<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RAH - Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e8f0ff;
        }
        .centered {
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
        }
        .login-container {
            background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.12);
            min-width: 300px;
        }
        .login-container h2 { color: #667eea; margin-bottom: 24px; }
        .form-group { margin-bottom: 18px; display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; color: #333; font-weight: 500; }
        .form-group input, select {
            padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;
        }
        .password-container {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            user-select: none;
            font-size: 1.2em;
        }
        .login-btn, .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none;
            padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 1em; width: 100%; margin-top: 10px;
        }
        .error-msg {
            color: #e53e3e; margin-bottom: 10px; text-align: center;
        }
        /* Dashboard styles */
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .navbar h1 { font-size: 1.8em; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .logout-btn:hover { background: white; color: #667eea; }
        .dashboard-container { display: flex; min-height: calc(100vh - 70px); }
        .sidebar { width: 250px; background: white; box-shadow: 2px 0 10px rgba(0,0,0,0.05); padding: 20px 0; }
        .menu-item {
            padding: 15px 30px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .menu-item:hover { background: #f0f4ff; border-left: 4px solid #667eea; }
        .menu-item.active { background: #f0f4ff; border-left: 4px solid #667eea; color: #667eea; font-weight: 600; }
        .main-content { flex: 1; padding: 30px; }
        .section { display: none; }
        .section.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page-header { margin-bottom: 30px; }
        .page-header h2 { color: #333; font-size: 2em; margin-bottom: 10px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.12);
        }
        .property-card { position: relative; }
        .property-image {
            width: 100%; height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 3em;
        }
        .property-title { font-size: 1.3em; margin-bottom: 10px; color: #333; }
        .property-location { color: #666; margin-bottom: 10px; }
        .property-price { font-size: 1.5em; color: #667eea; font-weight: bold; margin: 15px 0; }
        .property-features { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
        .feature-tag {
            background: #f0f4ff; padding: 5px 12px; border-radius: 15px;
            font-size: 0.85em; color: #667eea;
        }
        .search-container {
            background: white; padding: 25px;
            border-radius: 12px; margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 12px 30px;
            border-radius: 8px; cursor: pointer; font-size: 1em; transition: transform 0.3s;
        }
        .search-btn:hover { transform: translateY(-2px); }
        .btn-secondary {
            background: #f0f4ff; color: #667eea; border: 2px solid #667eea;
            padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s;
        }
        .btn-secondary:hover { background: #667eea; color: white; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px; margin-bottom: 30px;
        }
        .stat-card {
            background: white; padding: 25px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08); text-align: center;
        }
        .stat-number {
            font-size: 2.5em; color: #667eea; font-weight: bold;
        }
        .stat-label { color: #666; margin-top: 10px; }
        .profile-form {
            background: white; padding: 30px; border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08); max-width: 600px;
        }
        .history-table {
            width: 100%; background: white; border-radius: 12px;
            overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .history-table table { width: 100%; border-collapse: collapse; }
        .history-table th {
            background: #667eea; color: white; padding: 15px; text-align: left;
        }
        .history-table td { padding: 15px; border-bottom: 1px solid #e0e0e0; }
        .status-badge {
            padding: 5px 15px; border-radius: 15px; font-size: 0.85em; font-weight: 600;
        }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-confirmed { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }
        @media (max-width: 768px) {
            .dashboard-container { flex-direction: column; }
            .sidebar { width: 100%; }
        }
        #addPropertyContainer {
            background: white; padding: 20px; margin-bottom: 25px;
            border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            max-width: 400px;
        }
        #addPropertyContainer input, #addPropertyContainer select {
            width: 100%; padding: 8px; margin: 8px 0; border-radius: 8px;
            border: 2px solid #e0e0e0; font-size: 1em;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
  <div id="loginPage" class="centered" style="display:flex;">

        <div class="login-container">
            <h2>Login</h2>
            <div id="errorMsg" class="error-msg"></div>
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="loginName" required />
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="loginEmail" required />
            </div>
            <div class="form-group">
                <label>Password</label>
                <div class="password-container">
                    <input type="password" id="loginPassword" required />
                    <span class="password-toggle" onclick="togglePassword()">üëÅÔ∏è</span>
                </div>
            </div>
            <div class="form-group">
                <label>Role</label>
                <select id="loginRole" required>
                    <option value="user" selected>User</option>
                    <option value="owner">Owner</option>
                </select>
            </div>
            <button type="button" class="login-btn" onclick="handleLogin()">Login</button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" style="display:none;">
        <div class="navbar">
            <h1>üè† RAH - Dashboard</h1>
            <div class="user-info">
                <span id="userName">Welcome, User</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="dashboard-container">
            <div class="sidebar">
                <div class="menu-item active" onclick="showSection('search', event)">üîç Search Properties</div>
                <div class="menu-item" onclick="showSection('profile', event)">üë§ My Profile</div>
                <div class="menu-item" onclick="showSection('bookings', event)">üìã My Bookings</div>
                <div class="menu-item" onclick="showSection('history', event)">üìä History</div>
            </div>

            <div class="main-content">
                <div id="addPropertyContainer" style="display:none;">
                    <h3>Add New Property</h3>
                    <input type="text" id="newTitle" placeholder="Title" />
                    <input type="text" id="newLocation" placeholder="Location" />
                    <input type="number" id="newPrice" placeholder="Price (‚Çπ/month)" />
                    <select id="newType">
                        <option value="apartment">Apartment</option>
                        <option value="villa">Villa</option>
                        <option value="house">House</option>
                        <option value="flat">Flat</option>
                    </select>
                    <select id="newBedrooms">
                        <option value="1">1 BHK</option>
                        <option value="2">2 BHK</option>
                        <option value="3">3 BHK</option>
                        <option value="4">4+ BHK</option>
                    </select>
                    <button onclick="addProperty()" class="btn-primary">Add Property</button>
                </div>

                <div id="search" class="section active">
                    <div class="page-header">
                        <h2>Search Properties</h2>
                        <p>Find your perfect home</p>
                    </div>
                    <div class="search-container">
                        <div class="search-form">
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" placeholder="City or Area" id="searchLocation" />
                            </div>
                            <div class="form-group">
                                <label>Budget (Max)</label>
                                <input type="number" placeholder="Enter max budget" id="searchBudget" />
                            </div>
                            <div class="form-group">
                                <label>Property Type</label>
                                <select id="searchType">
                                    <option value="">All Types</option>
                                    <option value="apartment">Apartment</option>
                                    <option value="villa">Villa</option>
                                    <option value="house">House</option>
                                    <option value="flat">Flat</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Bedrooms</label>
                                <select id="searchBedrooms">
                                    <option value="">Any</option>
                                    <option value="1">1 BHK</option>
                                    <option value="2">2 BHK</option>
                                    <option value="3">3 BHK</option>
                                    <option value="4">4+ BHK</option>
                                </select>
                            </div>
                            <div class="form-group"><label>&nbsp;</label>
                                <button type="button" class="search-btn" onclick="searchProperties()">Search</button>
                            </div>
                        </div>
                    </div>
                    <div class="cards-grid" id="propertiesGrid"></div>
                </div>

                <div id="profile" class="section">
                    <div class="page-header">
                        <h2>My Profile</h2>
                        <p>Manage your account details</p>
                    </div>
                    <div class="profile-form">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profileName" />
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="profileEmail" />
                        </div>
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="profilePhone" value="+91 9876543210" />
                        </div>
                        <div class="form-group">
                            <label>Preferred Location</label>
                            <input type="text" id="profileLocation" value="Hyderabad" />
                        </div>
                        <div class="form-group">
                            <label>Budget Range</label>
                            <input type="text" id="profileBudget" value="‚Çπ20,000 - ‚Çπ30,000" />
                        </div>
                        <button class="btn-primary" type="button" onclick="updateProfile()">Update Profile</button>
                    </div>
                </div>

                <div id="bookings" class="section">
                    <div class="page-header">
                        <h2>My Bookings</h2>
                        <p>Track your booking requests</p>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Pending</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Confirmed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">2</div>
                            <div class="stat-label">Rejected</div>
                        </div>
                    </div>
                    <div class="history-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Property</th>
                                    <th>Location</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div id="history" class="section">
                    <div class="page-header">
                        <h2>Search & Payment History</h2>
                        <p>View your past activities</p>
                    </div>
                    <div class="history-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Activity</th>
                                    <th>Property</th>
                                    <th>Date</th>
                                    <th>Amount</th>
                                </tr>
                            </thead>
                            <tbody id="historyTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const properties = [
            { id: 1, title: "Luxury Apartment", location: "Banjara Hills, Hyderabad", price: "‚Çπ25,000", type: "apartment", bedrooms: 2, features: ["Parking", "Furnished", "Wi-Fi"], photo:"images/aparts.jpg" },
            { id: 2, title: "Modern Villa", location: "Jubilee Hills, Hyderabad", price: "‚Çπ45,000", type: "villa", bedrooms: 3, features: ["Garden", "Pool", "Parking"],photo: "images/villas.jpg" },
            { id: 3, title: "Cozy Flat", location: "Gachibowli, Hyderabad", price: "‚Çπ18,000", type: "flat", bedrooms: 1, features: ["Furnished", "Security"], photo: "images/flats.jpg" }
        ];

        const bookings = [
            { property: "Luxury Apartment", location: "Banjara Hills", date: "2024-11-15", status: "pending" },
            { property: "Modern Villa", location: "Jubilee Hills", date: "2024-11-10", status: "confirmed" },
            { property: "Cozy Flat", location: "Gachibowli", date: "2024-11-05", status: "rejected" }
        ];

        const history = [
            { activity: "Search", property: "Apartments in Banjara Hills", date: "2024-11-14", amount: "-" },
            { activity: "Payment", property: "Booking Fee - Luxury Apartment", date: "2024-11-13", amount: "‚Çπ1,000" }
        ];

        function togglePassword() {
            const passwordInput = document.getElementById('loginPassword');
            const toggle = document.querySelector('.password-toggle');
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggle.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggle.textContent = 'üëÅÔ∏è';
            }
        }

        async function handleLogin() {
    const name = document.getElementById('loginName').value.trim();
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const role = document.getElementById('loginRole').value;
    const errorMsg = document.getElementById('errorMsg');

    if (!email || !password) {
        errorMsg.textContent = 'Please fill all fields';
        return;
    }

    try {
        // Try login first
        const res = await fetch('http://localhost:5000/api/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        });
        const data = await res.json();

        if (res.ok) {
            localStorage.setItem('userData', JSON.stringify(data.user));
            showCorrectPage();
        } else if (data.message === 'Invalid email or password') {
            // Offer registration
            if (confirm('User not found. Register instead?')) {
                const regRes = await fetch('http://localhost:5000/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password, role })
                });
                const regData = await regRes.json();
                if (regRes.ok) {
                    alert('Registration successful!');
                    localStorage.setItem('userData', JSON.stringify(regData.user));
                    showCorrectPage();
                } else {
                    errorMsg.textContent = regData.message;
                }
            }
        } else {
            errorMsg.textContent = data.message;
        }
    } catch (err) {
        errorMsg.textContent = 'Server not reachable. Please check console.';
        console.error(err);
    }
}

            

            if (password.length < 6) {
                document.getElementById('errorMsg').textContent = 'Password must be at least 6 characters';
                
            }

            const userData = { name, email, password, role };
            localStorage.setItem('userData', JSON.stringify(userData));
            
            document.getElementById('loginName').value = '';
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('errorMsg').textContent = '';
            
            showCorrectPage();
        

        function showSection(sectionId, event) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            if (event && event.target) event.target.classList.add('active');
        }

        function loadProperties(filter = {}) {
            const grid = document.getElementById('propertiesGrid');
            let filteredProps = properties;

            if(filter.location) {
                filteredProps = filteredProps.filter(p => p.location.toLowerCase().includes(filter.location.toLowerCase()));
            }
            if(filter.budget) {
                filteredProps = filteredProps.filter(p => {
                    const numPrice = parseInt(p.price.replace(/[^\d]/g, ''), 10);
                    return numPrice <= filter.budget;
                });
            }
            if(filter.type) {
                filteredProps = filteredProps.filter(p => p.type === filter.type);
            }
            if(filter.bedrooms) {
                if(filter.bedrooms === '4') {
                    filteredProps = filteredProps.filter(p => p.bedrooms >= 4);
                } else {
                    filteredProps = filteredProps.filter(p => p.bedrooms === parseInt(filter.bedrooms, 10));
                }
            }

            if(filteredProps.length === 0) {
                grid.innerHTML = '<p>No properties found matching your criteria.</p>';
                return;
            }

            grid.innerHTML = filteredProps.map(p => `
               <div class="card property-card">
                    <div class="property-image">
                        <img src="${p.photo}" alt="${p.title}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" />
                    </div>
                    <h3 class="property-title">${p.title}</h3>
                    <p class="property-location">üìç ${p.location}</p>
                    <div class="property-price">${p.price}/month</div>
                    <div class="property-features">${p.features.map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>
                    <button class="btn-primary" onclick="bookProperty(${p.id})" style="width: 100%; margin-top: 15px;">Book Now</button>
                </div>
            `).join('');
        }

        function searchProperties() {
            const location = document.getElementById('searchLocation').value.trim();
            const budget = parseInt(document.getElementById('searchBudget').value, 10);
            const type = document.getElementById('searchType').value;
            const bedrooms = document.getElementById('searchBedrooms').value;
            loadProperties({ location, budget, type, bedrooms });
        }

        function bookProperty(id) {
            const property = properties.find(p => p.id === id);
            if (confirm(`Book ${property.title}?`)) {
                alert('Booking request sent!');
            }
        }

        function loadBookings() {
            const tbody = document.getElementById('bookingsTableBody');
            tbody.innerHTML = bookings.map(b => `
                <tr>
                    <td>${b.property}</td>
                    <td>${b.location}</td>
                    <td>${b.date}</td>
                    <td><span class="status-badge status-${b.status}">${b.status.toUpperCase()}</span></td>
                    <td><button class="btn-secondary">View Details</button></td>
                </tr>
            `).join('');
        }

        function loadHistory() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = history.map(h => `
                <tr>
                    <td>${h.activity}</td>
                    <td>${h.property}</td>
                    <td>${h.date}</td>
                    <td>${h.amount}</td>
                </tr>
            `).join('');
        }

        function updateProfile() {
            const name = document.getElementById('profileName').value.trim();
            const email = document.getElementById('profileEmail').value.trim();
            if (!name || !email) {
                alert('Please enter name & email');
                return;
            }
            let userData = JSON.parse(localStorage.getItem('userData'));
            userData.name = name;
            userData.email = email;
            localStorage.setItem('userData', JSON.stringify(userData));
            document.getElementById('userName').textContent = `Welcome, ${name}`;
            alert('Profile updated successfully!');
        }

        function logout() {
            localStorage.removeItem('userData');
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginPage').style.display = 'flex';
        }

        function addProperty() {
            const title = document.getElementById('newTitle').value.trim();
            const location = document.getElementById('newLocation').value.trim();
            const price = document.getElementById('newPrice').value.trim();
            const type = document.getElementById('newType').value;
            const bedrooms = parseInt(document.getElementById('newBedrooms').value, 10);

            if (!title || !location || !price || !type || !bedrooms) {
                alert('Please fill all fields');
                return;
            }
            const newProp = {
                id: properties.length + 1,
                title,
                location,
                price: `‚Çπ${price}`,
                type,
                bedrooms,
                features: []
            };
            properties.push(newProp);
            alert('Property added successfully!');
            loadProperties();

            document.getElementById('newTitle').value = '';
            document.getElementById('newLocation').value = '';
            document.getElementById('newPrice').value = '';
            document.getElementById('newType').value = 'apartment';
            document.getElementById('newBedrooms').value = '1';
        }

        function showCorrectPage() {
            const userData = JSON.parse(localStorage.getItem('userData'));
            if (userData && userData.name && userData.email && userData.role) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';

                document.getElementById('userName').textContent = `Welcome, ${userData.name}`;
                document.getElementById('profileName').value = userData.name;
                document.getElementById('profileEmail').value = userData.email;

                if(userData.role === 'owner') {
                    document.getElementById('addPropertyContainer').style.display = 'block';
                } else {
                    document.getElementById('addPropertyContainer').style.display = 'none';
                }

                loadProperties();
                loadBookings();
                loadHistory();
            } else {
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginPage').style.display = 'flex';
            }
        }

        window.onload = () => {
            showCorrectPage();
        };
    </script>
</body>
</html>